<!DOCTYPE html>
<html>
<head>
	<title>HighViz</title>
</head>      

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js"></script>
    
      <script type="text/javascript" src="https://fb.me/react-with-addons-0.14.0.js"></script>
    
      <script type="text/javascript" src="https://fb.me/react-dom-0.14.0.js"></script>




<body>

<div id='interface1'></div>

<script type='text/babel'>

function getImageLinksFromFlickrApi(tag) {
	var flickrAPI = "http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?";
	return $.getJSON(flickrAPI, {
		tags: tag,
		tagmode: "any",
		format: "json"
	}).then(function(data) {
		return data.items.map(function(item) { return item.media.m; });
	});
}

function getImagesForEntities(entities) {
	var entitiesToImages = {};
	var dfd = $.Deferred();

	entities.forEach(function(entity) {
		getImageLinksFromFlickrApi(entity).then(function(links){
			entitiesToImages[entity] = links
		})
	});

	return dfd.promise();
}

var ParamsInput = React.createClass({
	getInitialState: function(){
		return {
			entities_text: 'forest,leaves',
			weights_text: '80,20',
			entities: ['forest','leaves'],
			weights: [80,20]
		};
	},

	entitiesOnChange: function(e){
		this.setState({ entities_text: e.target.value, entities: e.target.value.split(',') })
	},

	weightsOnChange: function(e){
		this.setState({ weights_text: e.target.value, weights: e.target.value.split(',') })
	},

	weightsAndEntities: function(){
		var self = this;
		var waes = [];
		var i = 0;
		this.state.entities.map(function(entity){
			var weight = self.state.weights[i];
			if(weight) {
				waes.push({ entity: entity , weight: weight });
			}
			i++;
		})
		return waes;
	},

	getImages: function() {
		var self = this;
		getImageLinksFromFlickrApi(this.state.entities[0]).then(function(data){
			self.setState({ imgs: data.map(function(img){ return <img src={img}/> }) })
		});
	},

	componentDidMount: function() {
		this.getImages();
	},

	render: function(){
		this.getImages();

		return (
			<div>
				<label>entities:</label><input type='text' value={this.state.entities_text} onChange={this.entitiesOnChange}/>
				<label>weights:</label><input type='text' value={this.state.weights_text} onChange={this.weightsOnChange}/>

				{this.state.imgs}

			</div>
		);
	}

})

ReactDOM.render(<ParamsInput/>, document.getElementById('interface1'));

</script>

</body>
</html>